---
title: Markdown 展示
icon: fab fa-markdown
order: 2
category:
  - 使用指南
tag:
  - Markdown
---
#### day13-事务-AOP

## 事务

### 1.保证一组操作要么同时成功或者同时失败

### 2.三个操作

- 开启事务

  - start transaction;

- 提交事务

  - commit; 

- 回滚事务

  - rollback;

- 没有boot的时候

  - try{
    //1.开启事务
    操作1;
    操作2;
    ....
    //2.提交事务
    }catch(Exception e){
    //3.回滚事务
    }

- 有boot的时候

  - 只需要挂@Transactional这个注解即可

    - 声明式事务, 声明个注解事务就会被管理
    - rollbackFor

      - boot仅仅帮你在runtime异常回滚

    - propagation

      - 事务的传播行为
      - REQUIRED(默认值)

        - 需要事务, 如果有加入, 没有则创建新的

      - REQUIRES_NEW

        - 需要事务, 不管有没有都创建新的

  - boot帮我们try catch

### 注意事项

- boot只会帮我们回滚运行时异常,  我们想要回滚编译时异常需要添加rollbackFor= 异常类型,   我们告诉boot什么异常要回滚!!!!!

## AOP

### 概念

- 面向切面编程;(对已经存在的代码功能进行增强控制的技术)
- 相关名词

  - 目标对象

    - 我们希望增强的类;(原来项目中已经存在的功能类)

  - 连接点

    - 目标对象中的任意一个方法都是一个连接点;

  - 切入点

    - 符合切入点表达式的连接点就是切入点;

  - 切入点表达式

    - 描述什么样的连接点有资格成为切入点的字符串表达式;

  - 通知

    - 我们新增的对目标对象中的功能进行增强的逻辑(就是我们自定义的增强逻辑的方法);

  - 切面

    - 描述切入点和通知之间的联合关系的动作就是切面;(这个是重点)

### 作用:

- 可以在不改变原码的情况下对功能进行增强

### 原理

- 基于动态代理完成的

  - JDK动态代理

    - 缺点: 只能面向接口编程

  - CGLIB代理

    - 可以面向类带来, 本质造了一个类的子类

### 切面

- @Asepct注解标注是一个切面类
- 通知的类型

  - 虽然有很多, 但是最后只用一个@Around

- 切点表达式

  - execution

    - ..

      - 匹配任意层级或者任意个数的内容

    - *

      - 匹配单个目录, 类, 方法, 单个参数

    - 习惯

      - 包结构慎用.. 
      - 尽量给接口添加aop
      - 读表达式从右往左读

  - @annotation

    - 1: 自定义一个注解
    - 2: 描述带有指定注解的方法可以作为切入点

  - 对比

    - execution 的通用性更强,可以做到,写1次,匹配多个方法;
    - annotation 可以精确到具体的某个方法,如果方法之间没有规律,或需要增强的方法数量较少,可以采用这种方式;

### 练习

- 1.思考如何对所有请求参数进行去除前后空格
- 2. 统计业务层每个方法执行的时间
- 3: 完成课堂的解散部门的日志记录功能和最后的操作记录功能;

